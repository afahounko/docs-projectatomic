=== Getting to know the Cockpit interface

Once you have logged in, you will see the tabs for the Dashboard and the individual machines added to Cockpit.

*Dashboard*: Shows a list of all systems added to the Cockpit server with graphs for CPU usage, memory usage, disk I/O, and network traffic.

image:dashboard.png[caption="Dashboard", title="Dashboard", alt="Sunset", link="dashboard.png"]

You can then select a system name, in this case "rhel atomic 7.2.3", and have a look at the side menu:

*System*: Shows information about the system that Cockpit is running on. This includes CPU usage, memory usage, disk I/O, and network traffic, as well as hardware and operating system details.

image:select_system.png[caption="Select system", title="Select system", alt="Sunset", link="select_system.png"]

*Services*: Shows the systemd services running on the Cockpit server. You can see which are active/enabled or inactive. You can also see other systemd features: Targets, sockets, timers, and paths.

image:services.png[caption="Services", title="Services", alt="Sunset", link="services.png"]

Select a service to view its details:

image:services_detail.png[caption="Services Detail", title="Services Detail", alt="Sunset", link="services_detail.png"]

*Containers*: Lists all images available on the system, all running and non-running containers, combined CPU & memory usage graphs, and a storage usage bar.

image:containers.png[caption="Containers", title="Containers", alt="Sunset", link="containers.png"]

*Logs*: See messages produced by the systemd journal. These are errors, warnings, and notices that are generated by systemd services and gathered by the journal (like the output of the journalctl command). Errors are listed by the date they occurred. You can also view warnings, notices, or all messages.

image:logs.png[caption="Logs", title="Logs", alt="Sunset", link="logs.png"]

*Networking*: See networking interfaces (eth0, docker0, etc.) as well as the amount of data being sent and received.

image:networking.png[caption="Networking", title="Networking", alt="Sunset", link="networking.png"]

*Tools*: View other system information:

* *Subscriptions*: Displays what Red Hat products are installed and subscribed.

image:subscriptions.png[caption="Subscriptions", title="Subscriptions", alt="Sunset", link="subscriptions.png"]

* *Accounts*: Shows which administrative (root) and other users (atomic_user1, atomic_user2) have accounts on the system.

image:accounts.png[caption="Accounts", title="Accounts", alt="Sunset", link="accounts.png"]

* *Diagnostic report*: Collects system configuration and diagnostics information and prepares a report in an XZ format.

image:diagnostics_report.png[caption="Diagnostics Report", title="Diagnostics Report", alt="Sunset", link="diagnostics_report.png"]

You can then download the report locally on your system:

image:diagnostics_report_download.png[caption="Download Diagnostics Report", title="Download Diagnostics Report", link="diagnostics_report_download.png"]

* *Terminal*: Opens a Terminal (command line) session to the Cockpit system. From there, you can run any commands available to the user you are logged in as. For example, as root, you could run docker or kubectl commands.

image:terminal.png[caption="Terminal", title="Terminal", alt="Sunset", link="terminal.png"]

* *Software Updates*: Shows the available OSTrees on the system. You can also check for a newer tree, or rollback to a previous version.

image:software_updates.png[caption="Software Updates", title="Software Updates", alt="Sunset", link="software_updates.png"]

==== Adding another system to monitor

Once you log in to the primary server, you will be able to connect to additional servers. These secondary systems need to have:

* The Cockpit packages installed.
* An SSH server running and available on port 22 that supports password or key-based authentication.

The cockpit-ws component is not necessary on these additional systems.

From the "Dashboard" tab next to the system name, choose the "plus" button to add a new host. You can then add the IP of the secondary machine and choose which color will represent it in the user interface.

image:add_host.png[caption="Adding another system", title="Adding another system", alt="Sunset", link="add_host.png"]

Select the user name and type in the password:

image:add_host_passwd.png[caption="Adding another system password", title="Adding another system password", link="add_host_passwd.png"]

*Configuring Key-Based Authentication*

If you have keys generated on the primary server, you need to add them to the target server, in the _~/.ssh/authorized_keys_ file. If you do not have keys, use the following command:

....
$ ssh-keygen
....

Next, copy the contents of the _~/.ssh/id_rsa.pub_ file to the _~/.ssh/authorized_keys_ file *on the target server*. Then, return to the user interface on the primary server, click the top right corner menu with the user name on it, choose *Authentication*, and enable the preloaded key.

image:key_auth_on.png[caption="Adding another system password", title="Adding another system password", alt="Sunset", link="key_auth_on.png"]

After you type in the IP when adding the new system to the Dashboard, change the *Authentication* type to *Use available credentials*.

==== Logging to other systems through Cockpit

On the login screen, you can also choose an alternate host to connect to. Type in your username and password from that alternate host, then click *Other Options*, in the entry field type the IP address of the new host, and click *Log In*. You will be prompted for the SSH fingerprint, click *Log In* again, and you will be able to browse the new system. Cockpit uses SSH to authenticate you against that host, and you do not need to configure anything additionally on the new system. As a prerequisite, it will need to have SSH listening on port 443, and the `cockpit-bridge` package installed and the same version as in the Cockpit server.

[NOTE]
As a prerequisite, it will need to have SSH listening on port 443, and the `cockpit-bridge` package installed and the same version as in the Cockpit server. If the new machine is not known to Cockpit, and you get the *Refusing to connect. Host is unknown* use the following command to allow connections from unknown hosts:
+
....
ssh-keyscan -H [ip_address] >> /var/lib/cockpit/known_hosts
....

Logging into a system via a Bastion Host
----------------------------------------

On the Cockpit login screen you can now choose an alternate host to
connect to. Cockpit with use SSH to authenticate you against that host,
and display the admin interface for that host.

Although browsers cannot use SSH directly to connect to machines or
authenticate against them, Cockpit can make this happen. Only one host
needs to have Cockpit listen on port 9090 available to browsers over
TLS, and other hosts can only have SSH accessible on the usual port 22.

==== Working with containers

The *Containers* tab presents you with a UI to interact with your images and containers. Apart from the system resources graphs, there are lists of all images you have locally on the system as well as all running and non-running containers.

* *Download an image.* Click the "Get new image" button from the images list to the right and enter an image name or a keyword. Choose an image and click "Download".

image:image_search.png[caption="Image Search", title="Image Search", alt="Sunset", link="", link="image_search.png"]

* *Starting and stopping containers.* From the "Containers" list, you can start and stop containers using the buttons on the right-hand side. Use the drop-down menu to see all or filter out the non-running containers.

image:containers_list.png[caption="Containers List", title="Containers List", alt="Sunset", link="containers_list.png"]

* *Click on a container to inspect it.* Shows the state, the command executed, the container's and image's IDs, a timestamp, as well as the container's own terminal:

image:container_details.png[caption="Container Details", title="Container Details", alt="Sunset", link="container_details.png"]

* *Click on an image to inspect it.* Shows the image's ID, entrypoint and command, and a list of containers based on that image. You can also delete the image from here or run a container from it.

image:image_details.png[caption="Image Details", title="Image Details", alt="Sunset", link="image_details.png"]

* *Run a container*. To run a container from an image, either click the triangle button from the right-hand side of the list or choose the image first and then click "Run" from the top right corner. A dialog is displayed where you can enter the required data for the new container:

image:run_image.png[caption="Run Image", title="Run Image", alt="Sunset", link="run_image.png"]

You can select which command the container should run, and you can also link that container to other containers, which will allow them to interact. In addition, you can expose a port when you want a specific service to be visible from the host.

==== Changing the port

*A.* On Red Hat Enterprise Linux Atomic Host:

....
atomic run rhel7/cockpit-ws --port 9898
....

*B:* On Red Hat Enterprise Linux:

Create the _/etc/systemd/system/websocket.cockpit.d/listen.conf_ file and, if needed, the preceding directories.

....
$ mkdir /etc/systemd/system/websocket.cockpit.d/
$ touch /etc/systemd/system/websocket.cockpit.d/listen.conf
....

The file should have the following content:

....
[Socket]
ListenStream=9898
....

Next, allow the new port through the firewall:

....
$ sudo firewall-cmd --add-port=9898/tcp
$ sudo firewall-cmd --permanent --add-port=9898/tcp
....

If you have SELinux enabled, change the default SELinux policy to allow the websm_port_t domain to listen on the TCP 9898 port:

....
$ sudo semanage port -a -t websm_port_t -p tcp 9898
....

If the port is already defined by some other part of the SELinux policy, use the _-m_ argument instead of _-a_ to modify the definition:

....
$ sudo semanage port -m -t websm_port_t -p tcp 9898
....

In order for the changes to take effect, run the following commands:

....
$ sudo systemctl daemon-reload
$ sudo systemctl restart cockpit.socket
....

You can now use the address with the newly assigned port in the web browser.
